<!DOCTYPE html>
<html lang="{{ 'he' if direction == 'rtl' else 'en' }}" dir="{{ direction }}">
<head>
<meta charset="UTF-8">
<style>
  @page {
    size: A4;
    margin: 15mm 15mm 20mm 15mm;
    @bottom-center {
      content: "BuilderOps";
      font-size: 9px;
      color: #9e9e9e;
    }
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: Arial, Helvetica, sans-serif;
    font-size: 12px;
    color: #333;
    direction: {{ direction }};
    line-height: 1.5;
  }

  .header {
    background: linear-gradient(135deg, #1565C0, #1976D2);
    color: white;
    padding: 18px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 6px;
    margin-bottom: 12px;
  }

  .header-title {
    font-size: 22px;
    font-weight: 700;
  }

  .header-info {
    text-align: {{ 'left' if direction == 'rtl' else 'right' }};
    font-size: 12px;
    opacity: 0.9;
  }

  .header-info div { margin-bottom: 2px; }

  .total-line {
    font-size: 14px;
    font-weight: 600;
    color: #555;
    margin-bottom: 16px;
    padding: 0 4px;
  }

  .defect-card {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    margin-bottom: 16px;
    page-break-inside: avoid;
    overflow: hidden;
  }

  .card-header {
    background: #f5f5f5;
    padding: 10px 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    border-bottom: 1px solid #e0e0e0;
  }

  .defect-num {
    font-size: 14px;
    font-weight: 700;
    color: #333;
  }

  .badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    color: white;
  }

  .badge-outline {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
    background: white;
    border: 1px solid #bdbdbd;
    color: #555;
  }

  .card-body {
    padding: 14px 16px;
  }

  .field-row {
    display: flex;
    margin-bottom: 6px;
    font-size: 12px;
  }

  .field-label {
    font-weight: 600;
    color: #666;
    min-width: 110px;
    flex-shrink: 0;
  }

  .field-value {
    color: #333;
    flex: 1;
  }

  .photos-row {
    display: flex;
    gap: 10px;
    margin-top: 12px;
    flex-wrap: wrap;
  }

  .photo-thumb {
    width: 160px;
    height: 120px;
    object-fit: cover;
    border-radius: 6px;
    border: 1px solid #e0e0e0;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #999;
    font-size: 16px;
  }

  .footer-brand {
    text-align: center;
    margin-top: 24px;
    padding-top: 12px;
    border-top: 1px solid #e0e0e0;
    color: #9e9e9e;
    font-size: 10px;
  }
</style>
</head>
<body>

<div class="header">
  <div>
    <div class="header-title">{{ s.report_title }}</div>
    <div style="font-size: 13px; margin-top: 4px; opacity: 0.85;">{{ project_name }}</div>
  </div>
  <div class="header-info">
    <div>{{ report_date }}</div>
    <div>BuilderOps</div>
  </div>
</div>

<div class="total-line">
  {{ total_count }} {{ s.total_tasks }}
</div>

{% if defects|length == 0 %}
<div class="empty-state">{{ s.no_defects }}</div>
{% endif %}

{% for d in defects %}
<div class="defect-card">
  <div class="card-header">
    <span class="defect-num">#{{ d.number }}</span>
    <span class="badge" style="background: {{ d.status_color }};">{{ d.status }}</span>
    <span class="badge" style="background: {{ d.severity_color }};">{{ d.severity }}</span>
    {% if d.is_repeated %}
    <span class="badge-outline">{{ s.repeated_task }}</span>
    {% endif %}
    <span class="badge-outline">{{ d.category }}</span>
  </div>
  <div class="card-body">
    <div class="field-row">
      <span class="field-label">{{ s.location }}:</span>
      <span class="field-value">{{ d.location }}</span>
    </div>
    <div class="field-row">
      <span class="field-label">{{ s.description }}:</span>
      <span class="field-value">{{ d.description }}</span>
    </div>
    <div class="field-row">
      <span class="field-label">{{ s.reporter }}:</span>
      <span class="field-value">{{ d.reporter }}</span>
    </div>
    <div class="field-row">
      <span class="field-label">{{ s.assignees }}:</span>
      <span class="field-value">{{ d.assignees }}</span>
    </div>
    <div class="field-row">
      <span class="field-label">{{ s.followup }}:</span>
      <span class="field-value">{{ d.followup }}</span>
    </div>
    <div class="field-row">
      <span class="field-label">{{ s.due_date }}:</span>
      <span class="field-value">{{ d.due_date }}</span>
    </div>
    <div class="field-row">
      <span class="field-label">{{ s.updated_at }}:</span>
      <span class="field-value">{{ d.updated_at }}</span>
    </div>
    {% if d.photos %}
    <div class="photos-row">
      {% for photo in d.photos %}
      <img class="photo-thumb" src="{{ photo }}" alt="{{ s.photos }}">
      {% endfor %}
    </div>
    {% endif %}
  </div>
</div>
{% endfor %}

<div class="footer-brand">
  BuilderOps &copy; {{ report_date[-4:] }}
</div>

</body>
</html>
