{
  "task_description": "Create Alembic migration for checklist templates system (5 tables)",
  "scoped_services": ["backend"],
  "files_to_modify": {
    "backend": [
      "app/models/__init__.py"
    ]
  },
  "files_to_create": {
    "backend": [
      "app/models/checklist_templates.py",
      "alembic/versions/004_add_checklist_templates.py"
    ]
  },
  "files_to_reference": [
    "backend/app/models/project.py",
    "backend/app/models/area.py",
    "backend/alembic/versions/003_add_inspection_models.py"
  ],
  "patterns": {
    "model_structure": "All models use UUID primary keys with default=uuid.uuid4, inherit from Base (app.db.session), use Mapped[] typing with mapped_column()",
    "timestamps": "created_at and updated_at with DateTime, default=datetime.utcnow, onupdate=datetime.utcnow",
    "foreign_keys": "Use ForeignKey with ondelete parameter (CASCADE, SET NULL, or RESTRICT), define bidirectional relationships with back_populates",
    "indexes": "Use index=True in mapped_column for single-column indexes",
    "cascades": "Use cascade='all, delete-orphan' in relationships for parent-child deletion behavior",
    "migration_pattern": "Manual migrations with op.create_table, postgresql.UUID(as_uuid=True) for UUIDs, server_default=sa.func.now() for timestamps"
  },
  "existing_implementations": {
    "description": "Found comprehensive SQLAlchemy model patterns with UUID PKs, proper relationships, cascading deletes, and Alembic migration structure",
    "relevant_files": [
      "backend/app/models/project.py",
      "backend/app/models/area.py",
      "backend/alembic/versions/003_add_inspection_models.py"
    ],
    "key_insights": [
      "UUID primary keys use UUID(as_uuid=True) with default=uuid.uuid4",
      "Timestamps use datetime.utcnow (not timezone-aware)",
      "Foreign keys specify ondelete behavior: CASCADE for child records, SET NULL for optional references, RESTRICT to prevent deletion",
      "Relationships use back_populates for bidirectional access",
      "Migrations use postgresql.UUID, server_default=sa.func.now() for timestamps",
      "Models import from app.db.session.Base, not a separate base_class module",
      "Existing migrations in backend/alembic/versions/ are manually written, not autogenerated"
    ]
  },
  "database_schema": {
    "tables_to_create": 5,
    "foreign_key_strategy": {
      "CASCADE": ["sub_sections->templates", "items->sub_sections", "instances->projects", "responses->instances"],
      "RESTRICT": ["instances->templates", "responses->item_templates"],
      "SET_NULL": ["instances->areas", "instances->created_by", "responses->responded_by"]
    },
    "indexes_required": 9,
    "unique_constraints": ["(instance_id, item_template_id) on checklist_item_responses"]
  },
  "created_at": "2026-01-29T16:40:34.212107"
}
