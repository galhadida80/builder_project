{
  "task_description": "Build a vertical timeline component to display the complete history of inspection events, status changes, findings, and activities",
  "scoped_services": ["backend", "frontend"],
  "files_to_modify": [
    "backend/app/api/v1/inspections.py",
    "backend/app/schemas/inspection.py",
    "frontend/src/types/index.ts",
    "frontend/src/api/inspections.ts",
    "frontend/src/pages/InspectionsPage.tsx"
  ],
  "files_to_create": [
    "frontend/src/components/InspectionHistoryTimeline.tsx"
  ],
  "files_to_reference": [
    "backend/app/api/v1/audit.py",
    "backend/app/models/audit.py",
    "backend/app/schemas/audit.py",
    "frontend/src/pages/AuditLogPage.tsx",
    "frontend/src/api/audit.ts",
    "frontend/src/components/ui/Card.tsx",
    "frontend/src/components/ui/EmptyState.tsx"
  ],
  "patterns": {
    "backend_audit_pattern": "Query audit_logs table filtered by entity_type='inspection' and entity_id. Use selectinload(AuditLog.user) for user relationship. Order by created_at desc.",
    "frontend_timeline_pattern": "Vertical layout using MUI Box, Chip, Typography. Event type to icon/color mapping (create→success, update→info, status_change→warning). Timestamp on left, event details on right.",
    "api_response_pattern": "Use CamelCaseModel for response schemas to convert snake_case to camelCase. Include user relationship in response.",
    "date_formatting": "Use JavaScript Date methods: toLocaleDateString() and toLocaleTimeString() for consistent formatting"
  },
  "existing_implementations": {
    "description": "Full audit logging system exists. All inspection CRUD operations already create audit logs via create_audit_log() function.",
    "relevant_files": [
      "backend/app/models/audit.py",
      "backend/app/api/v1/audit.py",
      "backend/app/services/audit_service.py",
      "frontend/src/pages/AuditLogPage.tsx"
    ],
    "key_insights": [
      "audit_logs table has: entity_type, entity_id, action, old_values, new_values, user, created_at",
      "AuditAction enum: CREATE, UPDATE, DELETE, STATUS_CHANGE, APPROVAL, REJECTION",
      "Existing audit API supports filtering by entity_type, entity_id, action, user_id, date range",
      "AuditLogPage.tsx shows similar timeline/history UI pattern with action icons and colors",
      "MUI v5.15.6 installed (no Timeline component - need custom vertical layout)"
    ]
  },
  "constraints": [
    "DO NOT create new history tracking - use existing audit_logs table",
    "DO filter by entity_type='inspection' server-side for performance",
    "DO use MUI components for consistency",
    "DO format dates with JavaScript Date methods (project standard)",
    "DO handle empty states, loading states, and error states",
    "DO NOT block page render waiting for timeline data (async load)"
  ],
  "created_at": "2026-02-01T01:20:35.137773",
  "updated_at": "2026-02-01T01:28:30.000000"
}
